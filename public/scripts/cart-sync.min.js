!function(){const n="https://arco-henna.vercel.app";let t=null,e=!1;function o(){return"undefined"!=typeof window&&window.CUSTOMER_ID?String(window.CUSTOMER_ID):null}function a(){return!!function(){const n=document.cookie.match(/(?:^|;\s*)persistent_cart_session=([^;]*)/);return n?decodeURIComponent(n[1]):null}()}async function r(){try{const n=await fetch("/cart.js",{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(n.ok){return await n.json()}}catch(n){console.error("Error fetching Shopify AJAX cart:",n)}return null}function i(n,t=null){n&&(localStorage.setItem("cart",JSON.stringify(n)),t&&t())}async function c(e){if(!t)return null;try{const o=await fetch(n+"/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,cartData:e||{}})});if(o.ok){return(await o.json()).cart||null}}catch(n){console.error("Error syncing local cart to backend:",n)}return null}function s(n,t){return JSON.stringify(n)===JSON.stringify(t)}t=o(),function(n){document.cookie=n?`user_id=${n}; path=/; SameSite=Lax`:"user_id=; Max-Age=0; path=/; SameSite=Lax"}(t);async function l(){if(console.log("syncCart"),t=o(),console.log("customerId",t),!t)return;const a=await r();console.log("localCart",a);const l=await async function(){if(!t)return null;try{const e=await fetch(`${n}/api/cart?userId=${encodeURIComponent(t)}`,{method:"GET",headers:{Accept:"application/json"}});if(e.ok)return(await e.json()).cart||null}catch(n){console.error("Error fetching backend cart:",n)}return null}();if(console.log("backendCart",l),console.log("firstSyncDone",e),!e)return console.log("First sync"),!(l&&l.items&&l.items.length>0)||a&&s(a,l)?!l&&a&&a.items&&a.items.length>0?(console.log("Syncing local cart to backend"),await c(a),void(e=!0)):void(e=!0):(console.log("Replacing Shopify cart with backend cart"),await async function(n){if(await fetch("/cart/clear.js",{method:"POST",credentials:"include"}),n&&n.items&&n.items.length>0){const t=n.items.map((n=>({id:n.shopifyVariantId||n.variantId||n.variant_id,quantity:n.quantity,properties:n.properties||void 0})));await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({items:t})})}await async function(n,t=10,e=300){for(let o=0;o<t;o++){if(s(await r(),n))return;await new Promise((n=>setTimeout(n,e)))}console.warn("Shopify cart did not match backend cart after waiting.")}(n)}(l),i(l,(()=>{(()=>{const n=document.querySelector(".cart-loaded-popup-backdrop");n&&n.remove();const t=document.createElement("div");t.className="cart-loaded-popup-backdrop",t.style.cssText="\n    position: fixed; z-index: 9999; inset: 0; pointer-events: none;\n  ";const e=document.createElement("div");e.className="cart-loaded-popup",e.style.cssText="\n    position: fixed;\n    top: 2rem;\n    right: 2rem;\n    min-width: 220px;\n    max-width: 300px;\n    background: rgba(255,255,255,0.5);\n    border-radius: 14px;\n    box-shadow: 0 4px 24px rgba(0,0,0,0.13);\n    padding: 1.2rem 1.2rem 1rem 1.2rem;\n    text-align: left;\n    backdrop-filter: blur(5px);\n    animation: fadeIn 0.4s;\n    pointer-events: auto;\n    font-family: inherit;\n  ";const o=document.createElement("button");o.innerHTML="&times;",o.setAttribute("aria-label","Close"),o.style.cssText="\n    position: absolute;\n    top: 0.5rem;\n    right: 0.7rem;\n    background: transparent;\n    border: none;\n    color: #888;\n    font-size: 1.3rem;\n    font-weight: bold;\n    cursor: pointer;\n    z-index: 2;\n    padding: 0;\n    line-height: 1;\n    transition: color 0.2s;\n  ",o.onmouseenter=()=>o.style.color="#222",o.onmouseleave=()=>o.style.color="#888",o.onclick=()=>{t.remove(),e.remove()},e.appendChild(o),e.innerHTML+='\n    <h1 style="font-size: 1rem; margin: 0 0 0.3rem 0; color: #222;">ðŸ›’ Don\'t miss your cart!</h1>\n    <p style="color: #444; margin: 0 0 1rem 0; font-size: 0.8rem;">You have an active cart in your account.</p>\n    <button id="cart-reload-btn" style="\n      background: linear-gradient(90deg, #6366f1 0%, #60a5fa 100%);\n      color: #fff;\n      border: none;\n      border-radius: 7px;\n      padding: 0.5rem 1rem;\n      font-size: 0.8rem;\n      font-weight: 600;\n      cursor: pointer;\n      box-shadow: 0 2px 8px rgba(99,102,241,0.10);\n      transition: background 0.2s, transform 0.1s;\n      margin-top: 0.2rem;\n      display: block;\n      width: 100%;\n    ">Go to cart</button>\n  ';const a=document.createElement("style");a.innerHTML="\n    @keyframes fadeIn {\n      from { opacity: 0; transform: translateY(-10px);}\n      to { opacity: 1; transform: translateY(0);}\n    }\n    .cart-loaded-popup-backdrop { animation: fadeIn 0.3s; }\n  ",document.head.appendChild(a),e.querySelector("#cart-reload-btn").onclick=()=>window.location.href="/cart",t.appendChild(e),document.body.appendChild(t)})()})),void(e=!0));if(console.log("Not first sync"),!(a&&l&&s(a,l))){if(a&&a.items&&a.items.length>0&&(!l||!s(a,l))){const n=await c(a);return console.log("Synced cart,  Si el local cambiÃ³, sube al backend SOLO si tiene items"),void(n&&i(n,null))}return!l||a&&s(a,l)?void 0:(console.log("Updating local cart with backend cart"),void i(l,null))}console.log("Local and backend cart are equal")}t=o(),t&&function(t){t&&fetch(n+"/api/session/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t})}).then((n=>{n.ok&&console.log("Session updated with userId:",t)})).catch((n=>{console.error("Error updating session with userId:",n)}))}(t),console.log("Script loaded"),function(){const n=window.fetch;window.fetch=function(...t){let o="string"==typeof t[0]?t[0]:t[0]?.url;return o&&o.match(/\/cart\/(add|update|change|clear)(\.js)?/)&&e&&setTimeout((()=>{l()}),500),n.apply(this,t)};const t=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(n,o,...a){return this.addEventListener("load",(function(){o&&o.match(/\/cart\/(add|update|change|clear)(\.js)?/)&&e&&setTimeout((()=>{l()}),500)})),t.call(this,n,o,...a)}}(),l(),async function(){let n=await r();setInterval((async()=>{const t=await r();t&&t.items&&t.items.length>0&&!s(t,n)&&(n=t,a()&&await c(t))}),2e3)}()}();