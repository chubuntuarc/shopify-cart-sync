!function(){const t="https://arco-henna.vercel.app";let n=null,e=!1;function i(){return"undefined"!=typeof window&&window.CUSTOMER_ID?String(window.CUSTOMER_ID):null}function a(){return!!function(){const t=document.cookie.match(/(?:^|;\s*)persistent_cart_session=([^;]*)/);return t?decodeURIComponent(t[1]):null}()}async function o(){try{const t=await fetch("/cart.js",{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(t.ok){return await t.json()}}catch(t){console.error("Error fetching Shopify AJAX cart:",t)}return null}function r(t,n=null){t&&(localStorage.setItem("cart",JSON.stringify(t)),n&&n())}async function c(e){if(!n)return null;try{const i=await fetch(t+"/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n,cartData:e||{}})});if(i.ok){return(await i.json()).cart||null}}catch(t){console.error("Error syncing local cart to backend:",t)}return null}function s(t,n){return JSON.stringify(t)===JSON.stringify(n)}n=i(),function(t){document.cookie=t?`user_id=${t}; path=/; SameSite=Lax`:"user_id=; Max-Age=0; path=/; SameSite=Lax"}(n);async function u(){if(n=i(),!n)return;const a=await o(),u=await async function(){if(!n)return null;try{const e=await fetch(`${t}/api/cart?userId=${encodeURIComponent(n)}`,{method:"GET",headers:{Accept:"application/json"}});if(e.ok)return(await e.json()).cart||null}catch(t){console.error("Error fetching backend cart:",t)}return null}();if(!e)return!(u&&u.items&&u.items.length>0)||a&&s(a,u)?!u&&a&&a.items&&a.items.length>0?(await c(a),void(e=!0)):void(e=!0):(await async function(t){if(await fetch("/cart/clear.js",{method:"POST",credentials:"include"}),t&&t.items&&t.items.length>0){const n=t.items.map((t=>({id:t.shopifyVariantId||t.variantId||t.variant_id,quantity:t.quantity,properties:t.properties||void 0})));await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({items:n})})}await async function(t,n=10,e=300){for(let i=0;i<n;i++){if(s(await o(),t))return;await new Promise((t=>setTimeout(t,e)))}console.warn("Shopify cart did not match backend cart after waiting.")}(t)}(u),r(u),e=!0,void console.log("Cart Loaded ⚡️"));if(!(a&&u&&s(a,u))){if(a&&a.items&&a.items.length>0&&(!u||!s(a,u))){const t=await c(a);return console.log("Cart saved ⚡️"),void(t&&r(t,null))}!u||a&&s(a,u)||r(u,null)}}n=i(),n&&function(n){n&&fetch(t+"/api/session/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n})}).then((t=>{t.ok})).catch((t=>{console.error("Error updating session with userId:",t)}))}(n),console.log("🏹 Arco - Cart Sync"),function(){const t=window.fetch;window.fetch=function(...n){let i="string"==typeof n[0]?n[0]:n[0]?.url;return i&&i.match(/\/cart\/(add|update|change|clear)(\.js)?/)&&e&&setTimeout((()=>{u()}),500),t.apply(this,n)};const n=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(t,i,...a){return this.addEventListener("load",(function(){i&&i.match(/\/cart\/(add|update|change|clear)(\.js)?/)&&e&&setTimeout((()=>{u()}),500)})),n.call(this,t,i,...a)}}(),u(),async function(){let t=await o();setInterval((async()=>{const n=await o();n&&n.items&&n.items.length>0&&!s(n,t)&&(t=n,a()&&await c(n))}),2e3)}()}();